{% extends "base.html" %}
{% load static %}

{% block main_content %}
{% if request.user.user_type == "1" %}
<div class="page-header">
    <div class="row align-items-center">
        <div class="col">
            <h3 class="page-title">Edit Course</h3>
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'view_course' %}">Courses</a></li>
                <li class="breadcrumb-item active">Edit Course</li>
            </ul>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <form method="POST" action="{% url 'edit_course' courses.id %}">
                    {% csrf_token %}
                    {% include "includes/messages.html" %}
                    <div class='row'>
                        <div class="col-12">
                            <h5 class="form-title"><span>Edit Course with their Corresponding Prices</span></h5>
                        </div>
                        <div class="col-12 col-sm-8">
                            <div class="form-group local-forms">
                                <label>Course</label>
                                <input type="text" class="form-control" name="course" placeholder="Enter Course" value="{{ courses.course_name }}">
                            </div>
                        </div>
                        <div class="col-12 col-sm-6">
                            <div class="form-group local-forms">
                                <label>Price</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">â‚¦</span>
                                    </div>
                                    <input type="text" class="form-control" name="price" placeholder="Enter Price" value="{{ courses.price }}">
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-5">
                            <div class="form-group local-forms">
                                <label>Month</label>
                                <input type="number" class="form-control" name="month" placeholder="Enter Number Month" value="{{ courses.months }}" required>
                            </div>
                        </div>
                    <div class="col-10">
                        <div class="form-group local-forms">
                            <label>Levels</label>
                            <div id="levels-container">
                                {% if levels %}
                                    {% for level in levels %}
                                    <div class="level-entry mb-2 p-2 border rounded">
                                        <div class="row align-items-end">
                                            <div class="col-4">
                                                <input type="text" class="form-control" name="level_name_{{ forloop.counter }}" placeholder="Level Name" value="{{ level.level }}" required>
                                            </div>
                                            <div class="col-6">
                                                <input type="text" class="form-control" name="level_desc_{{ forloop.counter }}" placeholder="Description (optional)" value="{{ level.descriptions }}">
                                            </div>
                                            <div class="col-2 text-end">
                                                <button type="button" class="btn btn-danger btn-sm delete-btn" onclick="removeLevel(this)"><i class="fas fa-trash"></i></button>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <button type="button" class="btn btn-success btn-sm mt-2" onclick="addLevel()">+ Add Level</button>
                        </div>
                    </div>
                    <script>
                    let levelCount = {{ levels|length|default:0 }};
                    function addLevel() {
                        levelCount++;
                        const container = document.getElementById('levels-container');
                        const levelDiv = document.createElement('div');
                        levelDiv.className = 'level-entry mb-2 p-2 border rounded';
                        levelDiv.innerHTML = `
                            <div class="row align-items-end">
                                <div class="col-4">
                                    <input type="text" class="form-control" name="level_name_${levelCount}" placeholder="Level Name" required>
                                </div>
                                <div class="col-6">
                                    <input type="text" class="form-control" name="level_desc_${levelCount}" placeholder="Description (optional)">
                                </div>
                                <div class="col-2 text-end">
                                    <button type="button" class="btn btn-danger btn-sm delete-btn" onclick="removeLevel(this)"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        `;
                        container.appendChild(levelDiv);
                    }
                    function removeLevel(btn) {
                        btn.closest('.level-entry').remove();
                    }
                    // Add one level by default if none exist
                    window.onload = function() {
                        if (levelCount === 0) { addLevel(); }
                    };
                    </script>
                        <div class="col-12">
                            <div class="student-submit">
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock main_content %} 